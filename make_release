#! /bin/sh
if ! cvs diff > /dev/null 2> /dev/null ; then
   echo There are changes not checked into CVS - please rectify
   exit 1
fi
# Update ChangeLog
if ! ../cvs2cl/cvs2cl.pl 2> /dev/null ; then
   echo Failed to update ChangeLog from CVS
   exit 1
fi
if test -f Makefile ; then
   if ! make distclean ; then
      echo make distclean failed
      exit 1
   fi
fi
if ! make distcheck ; then
   echo make distcheck failed
   exit 1
fi
if ! make dos_doc_zip ; then
   echo make dos_doc_zip failed
   exit 1
fi
if ! env CC=i386-pc-msdosdjgpp-gcc LDFLAGS=-s STRIP=echo CAVEROT=caverot.exe \
 CRLIB=-lalleg CROBJX=dosrot.o ./configure --with-x=no ; then
   echo djgpp configure failed
   exit 1
fi
if ! make djgpp ; then
   echo djgpp make failed
   exit 1
fi
if ! make distclean ; then
   echo make distclean failed
   exit 1
fi
PATH=/usr/local/cross-tools/bin:/usr/local/cross-tools/i386-mingw32msvc/bin:$PATH
if ! env ac_cv_c_bigendian=no LDFLAGS=-s ./configure --with-x=no ; then
   echo mingw configure failed
   exit 1
fi
if ! make mingw ; then
   echo mingw make failed
   exit 1
fi
