2e8608e0 (Olly Betts 2014-06-03 00:10:17 +1200    1) Mon Jun 02 12:08:39 GMT 2014  Olly Betts <olly@survex.com>

Changes in 1.2.14 (2014-06-??):

* aven: Fix "Cancel" to work on the print/export dialog, broken by changes in
  1.2.13.  (Reported by Brian Clipstone)

* aven: Fix wx assertion failures when showing hit test debug view on platforms
  such as 64-bit Linux.

* aven: When viewing from above, show "Plan" above the "clino" which indicates
  the tilt angle (instead of "Elevation -90Â°").

* aven: The extended font data now loads faster, and also uses less memory on
  64-bit platforms.

* aven: (German translation) Abbreviate "Blickrichtung" so it doesn't overfill
  the space available in the aven UI.

* (Microsoft Windows version): Include dump3d in the installer.

* Fix a compiler warning.

* Improve test coverage.

Changes in 1.2.13 (2014-05-15):

* aven: Fix --print option to wait for printing to happen before exiting
  (previously it would exit right after opening the print dialog, so you
  couldn't actually print anything out using it).

* aven: Increase the threshold for how close the pointer needs to be to a
  station from 5 pixels to 7 to try to help touchscreen users.  Reported by
  Hugh St Lawrence.

* aven: Add "fat finger" mode, toggled by pressing F2, to allow investigating
  if increasing the minimum pointer to station threshold helps Hugh's problems
  with using aven on a touch screen device.

* aven: The measuring line was unable to see stations which had just been
  revealed by toggling surface or underground legs on - this is now fixed.

* aven: Add "hit test grid debug" mode, which shows the hit test grid and how
  many entries are in each box (toggled by F3).

* aven: Pressing F4 now allows the user to toggle wxWidgets assertion messages
  off and back on.

* aven: Create the empty hit-test grid data structure lazily, to reduce start
  up time a little.

* cavern: Improve messages which talk about "tags" and/or "prefixes" in *begin
  and *end commands to instead talk about "survey names".

* cavern: For ages cavern has warned if you reentered a survey, but this
  warning was suppressed if it occurred at the same line of the same file as
  the survey was first entered, but this can only happen if you include the
  same survey file more than once, which isn't a sensible thing to do for a
  file with actual survey data in (you might reasonably do it to set up survey
  grade details or something like that).  The warning is now given in this
  situation too.

* cavern: After 5 warnings about reentering a survey we give up warning about
  it, but we used to keep reporting where the survey was originally entered -
  this secondary diagnostic message is now silenced when the main message is.

* (Microsoft Windows version): Compile C code with optimisation on.

* Add the start of a Russian translation, with messages take from therion.

* Minor translation updates to French.

* Fix compiler warning from GCC.

* Testsuite improvements:

  + Test that "..." anon station works.

  + cavern.tst: Check number of errors returned by all testcases which should
    fail and give an error count.

  + cavern.tst: Fix to actually fully test everything when builddir != srcdir.

Changes in 1.2.12 (2014-04-14):

* aven: Fix measuring line to show change in altitude rather than altitude
  itself (accidentally broken by changes in 1.2.11).  Reported by Brian
  Clipstone.

* aven: Fix printing when built with wxWidgets 3.0.

* aven: Several visual improvements to printouts:

  + Move the numbers below the scale bar down a little so that they don't
    overlap the scale bar ticks.

  + Set the clipping region after we draw the page border and info box to avoid
    clipping the border in print preview.

  + Tidy up the appearance of the compass and elevation arrow.

* aven: Fix to build with libav 10.  Reported by Moritz Muehlenhoff in
  <http://bugs.debian.org/739332>.

* aven: Fix to build with older libav where avcodec_free_frame() isn't
  available.

* (Linux version) survex.spec: Update spec file used for building RPM packages.

* (Unix version): Add "Keywords:" entry to .desktop files.

* (Unix version): Enable large file support, mostly to support filing systems
  which return 64 bit inode values, such as CIFS mounts.

* (Microsoft Windows version): Only allow "A-Z" or "a-z" for driver letters,
  rather than any character which is a letter in the current locale.

* Various translation updates.

Changes in 1.2.11 (2014-01-28):

* aven: Fix wxWidgets assertion when double clicking on an anonymous station.
  Reported by Kevin Dixon.

* aven: Embed the font data for the first 256 Unicode characters for use in the
  survey pane into the compiled aven binary to reduce start up overhead.  Any
  additional characters needed are loaded from a data file only if/when a
  character >= U+100 is actually needed (as before).

* aven: Fix display of Unicode characters above 256 when there's a character
  <= 256 earlier in the same string.

* aven: Use the actual width of Unicode characters above 256 rather than
  assuming they are 16 pixels wide.

* aven: If full screen, don't show the side panel when a new file is opened
  (e.g. via Ctrl+O).

* aven: Don't give an assertion failure when showing passages for a cave with
  no vertical extent.  Reported by Jonny Prouty.

* aven: Change terminology in print dialog - say "legend" instead of "info
  box".

* aven: Add option to show the tilt angle as a percentage gradient.

* aven: Show the units (degrees, grads, or percent) for the tilt and bearing
  indicators.

* aven: All length units are now translatable.

* aven: Split log_fl_error helper function out of CHECK_GL_ERROR macro, which
  will reduce code size and also the number of deprecation warnings about
  gluErrorString on Mac OS X 10.9.

* (Microsoft Windows version): aven: Try to work around redraw issues related
  to the measuring line by redrawing the whole window, which doesn't seem to be
  measurably slower.

* cavern: If *units is used to try to set units for LEVEL, PLUMB, or POSITION,
  give an error rather than quietly ignoring the attempt.

* cad3d: Make cad3d remap control characters and spaces in station names when
  generating PLT output in the same way aven does.

* Various translation updates (particular thanks to Eric Madelaine and Dennis
  Baudys), including the start of a Bulgarian translation, with messages taken
  from Therion and elsewhere.

* (Microsoft Windows version): On Microsoft Windows 2000 and newer, use
  GetUserDefaultUILanguage() to get the UI language to use.  For older
  versions, continue to use GetUserDefaultLCID().

* (Microsoft Windows version): The Indonesian translation will now be used
  automatically when the system language is set to Indonesian.

* (Mac OS X version): Fix to build with wx 3.0.0 on OS X 10.9.  Thanks to David
  A. Riggs for his work on this.

* (Mac OS X version): Update buildmacosx.sh script to use wx 3.0.0, and add a
  checksum check for the downloaded wx sources.

* Fix a lot of the compiler warnings when building with clang.

* doc/manual.sgml: Add missing quantities to the list documented as accepted by
  *units: LEFT, RIGHT, UP/CEILING, DOWN/FLOOR (missing entirely);
  BACKCOMPASS/BACKBEARING, BACKCLINO/BACKGRADIENT (missing from the main list,
  mentioned in list of the units that can be set for them); COUNT (missing
  alternative name for COUNTER); DX/EASTING, DY/NORTHING, DZ/ALTITUDE
  (incorrectly listed as X, Y, Z).  Reported by Jonny Prouty.

* Test suite: Improve test coverage for cavern.

Changes in 1.2.10 (2014-01-15):

* aven: Fix assertion if two mouse buttons are held down at the same time.
  If dragging with more than one mouse button held down, releasing one causes
  another which is still held down to take effect.  Reported by Brian
  Clipstone.

* aven: If we fail to start the external editor when the user clicks on an
  error or warning from cavern, show an error box.

* aven: If the survey has a title, add it as a top-level <title> element to
  exported SVG files.

* aven: Escape '<', '>', and '&' in labels in exported SVG files.

* aven: In GPX export, set the <time> element to the datestamp from the 3d
  file.

* aven: Don't try to write the title if it isn't set or is empty when exporting
  GPX files.

* aven: Don't bother looking up the printer page setup info when exporting.

* (Microsoft Windows version): aven: Fix crash on "File->Print" or
  "File->Export" under Windows XP, reported by Brian Clipstone.

* (Microsoft Windows version): aven: Fix error dialog about an incorrectly
  encoded filename which could occur if run without being asked to load a file
  on startup.

* (Microsoft Windows version): aven: Compile with optimisation on.

* img library, aven: Although processed CMAP data files are often referred to
  as "CMAP .XYZ files", it seems that actually, the extension .XYZ isn't used,
  rather .SHT (shot variant, produced by CMAP v16 and later), .UNA (unadjusted)
  and .ADJ (adjusted) extensions are.  Since we've long checked for .XYZ, we
  continue to do so in case anyone is relying on it, but also check for the
  other extensions.

* img library: Add new "datestamp_numeric" field to struct img giving the
  datestamp as a time_t in UTC (or (time_t)-1 if there's no datestamp or we
  failed to convert it).  For .3d >= v8, this field is reliable.  We attempt to
  convert date strings in .3d <= v7 and CMAP XYZ files, but may get the
  timezone wrong.

* img library: Fix my_strcasecmp() to handle top-bit set characters better.

* cavern: Fix NULL pointer dereference when processing Compass DAT file without
  'SURVEY DATE:'.

* doc/manual.sgml: Update references to Survex 1.1 which should be to 1.2.

* doc/manual.sgml: Note the station length limit Smaps used.

* Fix some compiler warnings if built with glibc's fortify source feature
  enabled.

Changes in 1.2.9 (2014-01-08):

* Document --3d-version in cavern man page and the manual.

* aven: Fix compilation error in movie export code with recent libavi.

* aven: Fix warning on stderr when export a movie as MPEG.

* img library: In non-hosted mode, don't define GETC and PUTC if they're
  already defined, to allow easy overriding with getc_unlocked() and
  putc_unlocked() (which are significantly faster on Linux).

* img library: In non-hosted mode, check that int is at least 32 bits,
  and if not, use long.  In practice, platforms with 16 bit int are mostly
  obsolete, but it's not hard to be portable here.

* img library: Add test that img.c and img.h compile in non-hosted mode
  (regression test for issue fixed in 1.2.8).

* (Microsoft Windows version): aven is now built with wxWidgets 3.0.0.

* Update translations from launchpad and from existing similar messages.

* Fix some compiler warnings.

Changes in 1.2.8 (2013-10-29):

* cavern: Fix handling of anonymous wall stations ('..' by default) to
  implicitly set the SPLAY leg flag, as was intended.  Reported by Thomas
  Holder.

* cavern: Tweak .err file output not to lose the space in front of certain
  statistics when the value gets large.

* cavern: Eliminate redundant progress message when solving simultaneous
  equations.

* aven: Add a format drop down to the export dialog, and only show fields which
  are meaningful and supported for the currently selected export format.  The
  format defaults to that used most recently.  The "Elements" and "View" boxes
  have been swapped in the print and export dialogs as that layout works much
  better when the "View" box is hidden.

* aven: Changing checkboxes in the print or export dialog didn't work in 1.2.7
  - now works again.  Reported by Anthony Day.

* aven: Add GPX export (based on findentrances patch from Olaf KÃ¤hler).  In
  this release the projection which the survey coordinates are in defaults
  to the BMN M31 grid used in the Totes Gebirge in Austria.  On Unix, you
  can edit ~/.aven and add a new line setting 'input_projection' to a PROJ
  projection string.  The ability to specify this projection in a better
  way is coming soon.

* aven: New export options "Origin in centre" and "Full coordinates" - the
  latter fixes #10.  GPX and PLT output implicitly force "full coordinates".

* aven: The "Sketch" vector drawing program got renamed to "Skencil" some
  time ago, so update references.

* aven: Make the Presentation->Play menu item a checkbox, to avoid a warning
  with wxMSW 2.9.5.  Reported by Brian Clipstone.

* aven: Make right click in an empty presentation mark the current position and
  open it to edit, instead of crashing.

* aven: Update movie export code to work with latest libav API.  Reported by
  Sebastian Ramacher.

* aven: Improve reporting of errors during the process of exporting a movie.

* aven: Don't try to close the movie if we aren't producing one.

* aven: Fix assertion failure when double-clicking on the survey with wx2.9.

* aven: Fix to build with wxMSW 2.9.5.

* aven: Fix to build with wx 2.9.5 with wx2.8 compatibility disabled.

* cad3d: The "Sketch" vector drawing program got renamed to "Skencil" some time
  ago, so add a new --skencil option to specify this output format.  The old
  name (--sketch) is still recognised for compatibility.

* cad3d: Make --marker-size work for Skencil and SVG output.

* dump3d: Make --show-dates option show dates for XSECT.

* img library:

  + Fix to work once more when used outside of Survex (missing definition of
    max() macro and a bad call to free() in img_close() for a file opened for
    reading).

  + Use lround() instead of round(), and make the tests around whether we use
    the library function or the our fallback implementation saner.

  + Fix // comments in C code for portability to pre-C99 compilers which don't
    support these as an extension.

  + Can now be compiled as C++ as well as as C.

* (Microsoft Windows version): The installer is now built with a newer version
  of Innosetup, and includes translations for all the languages which Survex
  itself has any translations for.

* (Microsoft Windows version): aven is now built with wxWidgets 2.9.5.

* Minor translation updates.

* tests/Makefile.am: Distribute files for "normal_bad" testcase.

Changes in 1.2.7 (2013-07-27):

* Add support for anonymous stations, which are indicated by one, two or three
  separator characters - with the default separator of '.', that means '.',
  '..', and '...' are anonymous stations.  Single separator ('.' by default)
  is an anonymous non-wall point, double separator ('..' by default)
  is an anoymous wall point at the end of an implicit splay), and triple
  separator ('...' by default) is an anoymous point (with nothing special about
  the leg).  A new *alias command allows '-' to be mapped to '..' for
  compatibility with pocket topo: *alias station - ..

* New version 8 of the 3d format:

  + Supports new flags img_SFLAG_ANON and img_SFLAG_WALL.

  + New explicit file-wide flag for 'this is an extended elevation', rather
    than modifying the survey title to indicate this.

  + The survey prefix is often unchanged from one leg to the next, so use a
    spare flag to compactly indicate when there's no label change.

  + The data style of each leg is now stored.

  + The "processed at" time is stored as seconds since 1970 rather than a
    human-readable string.

  + Since 3d v8 features significant changes to the format, the format
    documentation for v7 and earlier has been split off into 3dformat-old.htm.

* img library:

  + New station flags img_SFLAG_ANON and img_SFLAG_WALL.

  + Handle .pos files containing unnamed stations - don't suck the next line in
    as the station name, and set img_SFLAG_ANON for them.

  + Repurpose the long unused fBinary parameter to img_open_write() as a flags
    parameter, and add img_FFLAG_EXTENDED to specify that this is an extended
    elevation, in place of appending " (extended)" to the title.  Internally we
    still append this to the title (and remove it upon reading) when writing
    3d v7 or earlier, but for the new 3d v8 format, this flag is stored
    explicitly in the file.

  + img.h: Add comments for the lists of "Leg flags" and "Station flags".

* aven:

  + We now require at least wxWidgets 2.8.0 - it was released over 6 years ago
    now, and the wx developers consider even 2.8 to be rather long in the
    tooth.  We stopped testing building with wxWidgets 2.6 some time ago, and
    formally dropping support for older versions allows a number of workarounds
    to be removed from the aven source code.  Also, features deprecated in
    wxWidgets 2.9 are no longer used in our code.

  + Don't run incremental search on every key-press, as on a slow machine the
    short initial search(es) will take a while but not be useful.  Instead only
    actually run the search when we're told there are no more key-presses
    queued up.

  + Implement support for including cross-section information in exported SVG
    and DXF files (ticket#4).  The DXF export is untested currently.

  + Show splay legs faded by default, with menu options to hide them or show
    them like other legs.

  + Speed up loading a .3d file with cross-sections by using a map to convert
    station names to positions.

  + In the cavern log window, don't highlight a file:linenumber if there's no
    message after it, which avoids highlighting the "Included from" lines
    wrongly.

  + Fix not to crash when trying to report an error while starting up.

  + (MacOS X version): Change the menu shortcut for "Full Screen Mode" to be
    the OS X standard shortcut Shift-Command-F (previously we used F11, but
    that's used by the desktop).

  + Add checks for errors when reading the font file.

  + Remove useless extra quoting when invoking vim to show the location of an
    error from cavern.

  + Include GL/gl.h before GL/glext.h (needed on Debian wheezy).

  + Use wxValidator to simplify keeping svxPrintDlg member variables and fields
    in the dialog in sync.

* cavern:

  + Demote errors about invalid dates to warnings, since we've accepted *date
    for ages without any checks on the value, and so existing datasets
    probably contain invalid dates and dates in other formats.  (ticket#19)

  + New *alias command allows '-' to be mapped to '..' for compatibility with
    pocket topo: *alias station - ..

  + We want to warn if there's a clino reading which it would be impossible to
    have read from the instrument (e.g. on a -90 to 90 degree scale you can't
    read "93" (it's probably a typo e.g. for "39").  However, the gradient
    reading from a topofil is typically in the range 0 to 180, with 90 being
    horizontal.  Really we should allow the valid range to be explicitly
    specified, but for now we infer it from the zero error - if this is within
    45 degrees of 90 then we assume the instrument can read between 0 and 180
    degrees.

  + If the survey isn't all connected, still run survey tree checks and report
    errors and/or warnings which might suggest typo locations.  Thanks to Kevin
    Dixon for the report which highlighted this issue.

  + Report a warning if *begin SURVEY has a separator character in SURVEY.

  + Report column numbers as well as line numbers for some cavern errors and
    warnings.

  + Adjust width of node stats table to fit longest count when there are more
    than 9999 of a particular order of node.

  + If the argument to *include has an opening double quote but the closing
    double quote is missing, then skip trying to open the file.

  + Move "Station X referred to just once" warning after non-existent survey
    check - if both fire, the non-existent survey error is likely to be more
    relevant.

  + We no longer follow an error for a bad reading in passage data with a bogus
    "End of line not blank" error, but instead check the remaining readings on
    the same line.

  + We no longer follow an error about OMIT for a required reading with a bogus
    "End of line not blank" error.

  + Report an error if the scale factor in *calibrate is zero - it doesn't make
    sense and probably means someone reversed the arguments to *calibrate.

  + Report the parent include files starting from the outermost, as that's more
    logical when there are multiple levels involved.

  + If we were expecting a numeric field and instead get something which starts
    with '+', '-', or '.' but which isn't a number, then fix the error to
    include that character in the token reported.

  + Simplify handling of quantity lists to only recognise 'DEFAULT' as the
    first item.

* cad3d: Check for errors from img_rewind() and report them.

* dump3d:

  + Build, install and package dump3d as standard - it's useful for grabbing
    info from 3d files in scripts.

  + Add --show-dates option.

  + Show only 2 decimal places on coordinates and passage dimensions.

  + Report the data style of legs.

  + Report if the file is an extended elevation.

  + Report img_STOP as STOP rather than CODE_0xffffffff.

* Test suite:

  + cavern.tst: Fix equatenosuchstn testcase (added in 1.2.6) to normalise the
    expected output so it passes reliably.

  + cavern.tst: Run diffpos <expected> <actual> so the reports of 'Added' and
    'Deleted' stations upon failure are the more natural way round.

  + Add more testcases, expand some existing testcases, and add expected output
    for more.

* (Microsoft Windows version): Use wx-config's --cc and --cxx flags to find the
  appropriate C and C++ compilers to use, and link mingw build statically to
  avoid needing the libgcc DLL (which newer GCC seems to have by default).

* (Unix version): When determining the character set for command-line tools,
  check environmental variable LANG after LC_ALL and LC_CTYPE.

* When determining the language, check environmental variable LC_ALL before
  LC_MESSAGES and LANG (but after SURVEXLANG).

* If we don't find the message file, only give an error if it was specified
  with SURVEXLANG, since that is an explicit instruction to Survex, whereas
  LANG, LC_ALL and LC_MESSAGES are essentially system "preferred locale"
  settings.

* There are a handful of hard-coded English message strings for reporting
  errors trying loading message files, etc.  These are all now ASCII, as if we
  fail trying to open a message file, it's more likely the encoding isn't
  set correctly.

* Prune strings we are no longer using and are probably unlikely to use again
  into a new file po_codes_dead, so that translators don't get presented with
  them to translate.

* Merge lots of translation updates.  Most translations are now complete or
  close to complete.

* Add start of Indonesian translation from Arief Setiadi Wibowo.

* Fix various compiler warnings when building from source.

* Include scripts gdtconvert and gen_img2aven in the source distribution.

Changes in 1.2.6 (2012-02-23):

* (Mac OS X version): Fix so that cavern finds its messages when run by aven.

* (Microsoft Windows version): Include JPEG images for aven in the installer
  package (ticket#35).

* cavern: If we have a reference to a station in a non-existent survey, give a
  helpful error rather than saying the station hasn't been exported from the
  survey.  (Bug reported by Martin Green via email)

* aven: Fix to build with a non-Unicode wxWidgets library.  Patch from Olaf
  Kahler.

* findentrances: Add findentrances utility from Olaf Kahler which produces a
  .gpx file with waypoints for entrances.  This needs libproj so is disabled
  by default for this release - to enable it install the development stuff for
  libproj and build survex with:

      make FINDENTRANCES=findentrances
      make install FINDENTRANCES=findentrances

* dump3d: Add support for showing img_ERROR_INFO items.

* doc/3dformat.htm: Merge in some improvements from Mike McCombe.

* Incorporate a French translation from launchpad I'd previously copied the
  English version of by mistake.  Attempt to correct mistranslation of "survey
  file".

Changes in 1.2.5 (2012-01-03):

* aven:

  + The survey tree in the left panel is now in sorted order once more.

  + No longer fails with an assertion if used for a long time (we were leaking
    an OpenGL list each time one had to be regenerated).

  + Now builds with newer FFmpeg library.

  + Draw measuring line in front of the indicators rather than behind them.

  + Loading a new file (or reloading the current one) no longer invalidates
    the OpenGL lists for the compass and clino, so will be a fraction faster.

* Improve handling of attempts to look up translated messages before the
  message subsystem is fully initialised (which only happens if there's an
  error early on).

* Improve the survex(7) man page text, and fix it to be marked as section 7 in
  the man page source as well as in the filename.

Changes in 1.2.4 (2012-01-01):

* aven:

  + A change in 1.2.3 meant that aven tried to use OpenGL before it was
    initialised, which doesn't cause problems in some machines, but causes aven
    to abort on others.  This is now fixed, and there's a check in place to
    help avoid similar issues in future. (ticket#34)

  + Always use metres or feet for the depth colour key, and chose a consistent
    precision by looking at the depth range. (ticket#30)

  + Show the depth units below the colour bar rather than after every value.

  + When zooming way in, stay in metres rather than switching to cm.

  + On the scale bar, say â1 mileâ rather than â1 milesâ.

* Translation updates for Catalan, French and Slovak.

Changes in 1.2.3 (2011-12-31):

* Fix to build with wxWidgets 2.9.2.

* (Mac OS X version):

  + Processing .svx files from aven now works.

  + Remove spurious blank lines from the licence text in "Get Info".

  + Don't create the help menu at all, as it is empty (because the "About"
    entry goes elsewhere) and sometimes seems to appear in the UI.

  + INSTALL.OSX: Update to reflect current status.

* aven:

  + Fix Y coordinates of surface surveys on printouts.  (Closes #32)

  + Improvements to text plotted on the survey pane:

    - Support plotting Unicode character points > 256 by lazily loading the
      data for them from the font file and plotting them with a direct call to
      glBitmap(), which is slower but doesn't require a display list per
      character.

    - Adjust the spacing from fixed width to putting a one pixel gap either
      side of each one character (so two between adjacent glyphs).  Mostly this
      reduces the horizontal width, but it adds a pixel for characters like "m"
      and two in a few cases.

    - Fix .pixelfont file generation to correctly handle characters wider than
      8 pixels.

  + Fix expected cross shape so don't always reject using texture mapping to
    draw crosses.

  + As we read a survey file, eliminate tubes consisting of zero XSECTs as well
    as those consisting of just one.  Previously we would trip over the empty
    tube later.  Such tubes can for example be created by extend if a splay shot
    is the start or end of a tube.

  + Make the green colour used for entrances in the survey tree the same
    (slightly darker than before) green used for the entrance blobs.

  + Report the version of the library we're actually running with if built
    against wx >= 2.9.2.  Make it clear that the version reported is the
    version *built* with for wx < 2.9.2.

* extend:

  + Copy the end markers for passage tubes.

  + Preserve left and right data for tubes (previously they were set to -1.0
    which means "no info").

* img library: Fix incorrect comment in img.h which claimed that img_XFLAG_END
  was no longer used - it certainly is!

* Use curly double quotes instead of "`" and "'" to quote filenames, etc in
  messages, and curly single right quote instead of straight ASCII apostrophe.
  Fall back to using straight ASCII versions if we can't represent them in the
  current character set.

* Translation updates for Catalan, French, Slovak and Spanish.

* Test suite:

  + Add test coverage for interleaved diving data.

  + Add testcase for diving data with topofil-style distance.

Changes in 1.2.2 (2011-10-06):

* aven:

  + Replace the textured-mapped font drawing with an approach based on
    glBitmap.  This doesn't suffer from the character alignment issues which
    the textured-mapped fonts had, and is actually significantly faster on some
    machines.  The current font used is (mostly) fixed-width, but this isn't an
    inherent limitation - it was just the easiest font data to convert to a
    usable format.

  + Fix assertion failure due to rounding differences on loading certain .3d
    files.  (ticket#26)

  + Fix assertion failure when turning on 3D passages if they stick out higher
    or lower than any station.  (ticket#29)

  + Fix grid not to disappear when blobs are turned on and blobs are drawn
    using lines.

  + If a degree sign isn't available in the character set in use, transliterate
    it to 'dg' rather than skipping it.

  + Fix message which should have been a degree sign but got lost in the format
    change for 1.2.0 and then got reassigned in 1.2.1.  Externally, this means
    that bearings in the status bar now have a degree sign after them if they
    are in degrees rather than nothing (1.2.0) or "&Hide Compass" (1.2.1).

  + Fix print dialog to calculate the scale required for "One page" right
    before it calculates how many pages are required, so we don't end up
    something other than 1x1 being shown when the user changes settings.

  + Update the calculations for picking a scale and for deciding how many
    pages are needed to take into account the change in info box height made
    in 1.2.1.

Changes in 1.2.1 (2011-10-04):

* Translation updates for US English.

* aven:

  + Rename the "depth bar" to "colour key" in documentation, menus, etc since
    it now shows colours for dates and errors as well as depths.

  + In the colour key for "colour by date", change "No info" to "Undated".

  + Remove the dark grey background from the colour key and just put a single
    pixel black border around the colours.  This is more in keeping with the
    other controls, and means the colours are now on a black background so more
    visually similar to the survey legs.

  + Move the colour key's "Undated"/"Not in loop" entry down a little to
    improve the appearance.  Make each section a pixel taller.

  + Allow "Colour by X" to be selected even if there's no data for X or only a
    single value of X used (the colour key is much smaller in these cases, and
    does still provide some useful information).

  + Fix incorrect calculation of depth colouring for survey legs which straddle
    a depth band boundary.

  + The scale bar, compass, clino, and colour key now all have right click
    menus which allow related actions to be performed (especially handy in
    full-screen mode).

  + Improve the font used on the survey pane - it now contains the '-'
    character (so the clino now shows negative angles as negative, and dates
    in the colour key are now hyphenated).  Also the spacing and alignment
    are a little better, though still not perfect.

  + PLT file export now handles spaces and control characters in station names
    by escaping them with '%' as in URLs.

  + Pressing "Enter" on a station in the tree control now centres the view on
    that station.

  + The scale bar is now cached in an OpenGL display list since it often gets
    redrawn exactly the same - for example, when rotating, panning, etc.

  + Pressing "F5" forces all cached OpenGL drawing lists to be invalidated and
    then forces a refresh of the survey pane.  This is intended as a debugging
    aid - if pressing F5 changes the display at all then there's a missing case
    where a list should have been invalidated (please report if you find such
    a case as it is a bug).

  + We now automatically track which OpenGL display lists need to be
    invalidated on window width or height changes.

  + Increase scale bar maximum width from 65% of the window width to 75% as it
    was in 1.0.x (except that if that would overlap the clino we now reduce
    that proportion down until it reaches 50%).  Make the limit of zooming in
    the same as in 1.0.x.  (ticket#23)

  + (Linux version): Previously wxGTK didn't really handle showing a dialog if
    the application was fullscreen (the dialog got opened under the main
    window!)  To work around this, aven would switch out of full screen mode
    temporarily while showing a dialog.  This case works properly with recent
    wxGTK, so disable our workaround with versions we know work.  Also, apply
    the workaround only for wxGTK, not everywhere except on Microsoft Windows
    as there's no reason to think we need it for other platforms.

  + Grey out the "View North" action when we're already viewing North, and
    similarly for other compass points.

  + (Mac OS X and Microsoft Windows versions): Fix missing newline to OpenGL
    info in the "About" dialog.

  + Fix to set the correct filename on the root of the survey tree - previously
    the filename of the previous file loaded was used!

  + The movie export code now works with newer versions of the FFmpeg libraries
    as well as still working with older versions.

  + Fix mixed up messages - the print dialog now says "View" on the left
    subgroup of controls rather than some unrelated message.

  + On printouts, combine the "Plan View"/"Elevation" info box field with the
    field which gives the bearing and reduce the height on the info box by the
    removed field, so it's now 3cm for plans and elevations, as for extended
    elevations.  Report the tilt angle for tilted elevations which it seems has
    been missing for ages (it's not in recent 1.0.x either).

  + Tweak the exact positioning of informational text on printouts to look
    nicer and make better use of the available space.

  + Add keyboard mnemonics to the "Plan" and "Elevation" buttons in the print
    dialog.

  + Make the sign of the tilt angle for printouts consistent with the sign
    shown by the "clino" in the survey pane.

  + In the "Print" dialog, when in plan view disable the "Plan view" button,
    and similarly for the "Elevation" button.

  + (Microsoft Windows version): Sort out appearance of custom cursors.

  + If a label isn't valid UTF-8 or CP1252, fall back to ISO8859-1.

  + (Mac OS X version): F11 puts aven into full screen mode, but apparently
    you can't get out again easily, so add code to explicitly check for F11
    being pressed and toggle full screen.

* (Linux version): Fix the RPM .spec file for where man pages now get installed
  and package aven.svg and the vim support files.  (Fixes from James Begley)

* "make check" now performs several checks on the translation files.

* More messages are now available to be translated.

* cavern: Fix reporting of ranges of survey coordinates, which was broken by
  the message handling changes in 1.2.0.

* Fix warning when compiling with GCC.

* INSTALL: Mention building wxWidgets with --enable-unicode.  Mention using
  sudo for installing on Unix.

* In the manual, replace the instructions for building from source with a
  pointer to the clearer instructions in INSTALL.

* In the manual, make it clear that installing with administrator rights
  also applies to newer platforms than XP.

* doc/TODO.htm: Update.

Changes in 1.2.0 (2011-09-20):

* Translation updates for Catalan, French, Romanian, Spanish, Slovak, and US
  English.

* tests/smoke.tst: aven no longer requires an X display for --help or
  --version, so replace skip of this check with a check that this remains the
  case.

* We now use the standard .po and .pot file formats for storing translations
  (rather than the Survex-specific messages.txt format), and then translate
  these into Survex's .msg format.

* (Unix version): Move survex man page to section 7 (since it isn't documenting
  an actual command).

* (Unix version): Write each generated man page to a temporary file, then
  atomically rename, to avoid leaving an empty or partial man page behind if
  docbook-to-man dies (1.1.16 had an empty cad3d.1, and we want to avoid a
  recurrence of that).

* (Unix version): Default to installing docs into /usr/share/doc/survex rather
  than /usr/doc/survex.

* aven:

  + Fix handling of accented characters in the survey pane.

  + Aven icon redrawn in SVG format - it's now a vector image which looks
    nicer at larger sizes.

  + Explicitly request double-buffering, which seems to be needed for systems
    with GLX >= 1.3.

  + Fix crash while trying to load certain .3d files.

  + Movie export code updated to work with more recent versions of FFmpeg.
    Currently this is disabled in Microsoft Windows builds, pending getting the
    required libraries set up for building releases.

  + Reporting of errors during movie export improved.

  + Force playback speed to "x1" during movie export.

  + Use stock IDs for buttons where appropriate - such buttons may now be
    rendered with icons on some platforms.

  + If a label isn't valid UTF-8, treat it as CP1252 (the Microsoft superset of
    ISO8859-1).

  + (Unix version): Remove special handling for toggling "full screen" on wxGTK
    as it's no longer required with modern versions.

  + Don't redraw the survey on every mouse movement in the survey pane unless
    the measuring line is (or just was) active.  (ticket #17)

* cavern:

  + Drop "non-fatal" from the report of how many errors there were at the end
    of the run - it just confuses users - we won't even get here if there's a
    fatal error!

  + Add --3d-version option to allow the user to specify the version of the 3d
    format to output.  (ticket#21)

* img library:

  + Make the highest and lowest valid values for img_output_version available
    in img.h as IMG_VERSION_MIN and IMG_VERSION_MAX.

* (Mac OS X version): Fix buildmacosx.sh script to check where the temporary
  volume actually gets mounted.  Fix URL for downloading wxWidgets.

Changes in 1.1.16 (2011-05-16):

* Translation updates for German, Spanish, Italian, Portuguese, Brazilian
  Portuguese, and US English.

* Use horizontal ellipses character rather than '...' and right arrow character
  rather than '->' where these characters are available.

* (Unix version): Link with -lGL, if it exists, to support linking with gold or
  GNU ld --as-needed (Debian bug #615781).

* img.c:

  + Fix code typo for IMG_API_VERSION == 0 case.

  + Fix code typo in code used when IMG_HOSTED isn't defined.

* doc/TODO.htm: Remove entries which have now been done.

* (Microsoft Windows version): aven: We now include all the available
  translations for messages from wxWidgets, which means that standard widgets
  will appear translated where available even if Survex messages aren't
  translated.

Changes in 1.1.15 (2010-10-15):

* aven:

  + In the cavern log window, change the "Rerun" button to "Reprocess" to
    follow terminology in manual and elsewhere.  Fixes ticket#15.

  + When displaying output from cavern, don't update the window after every
    line, but only when we don't have data from cavern pending.  Hopefully
    addresses ticket#12.

  + If we aren't using GL_POINTS for blobs, draw them using a series of
    abutting lines rather than with gluDisk which is faster and gives a
    consistent shape.

  + Check whether blobs and crosses actually render correctly as points/point
    sprites, and if they don't, fall back to drawing them with lines.  The
    best method is cached on disk, and rechecked automatically if the graphics
    hardware is changed or the drivers upgraded.

  + Fix non-USE_FNT case to work again (it's limited to ISO-8859-1 characters
    though, so we still enable USE_FNT by default).

  + Don't offer "All files" wildcard in presentation save dialog.

  + (Microsoft Windows): Handle filenames with non-Latin1 characters in in
    more places.

  + (Microsoft Windows): Quote filenames with spaces and metacharacters in
    when running cavern from aven.  Fixes ticket#11.

* editwrap: (Microsoft Windows): Handle filenames with non-Latin1 characters.

* diffpos: Handle files with duplicate labels in better - extend generates
  duplicate labels when it breaks a loop.

* Enable eswap-break testcase now that diffpos handles duplicate station names.

* New v7 of .3d format which stores survey dates as number of days since
  January 1st 1900, so we now support dates from 1900-2078 (rather than
  1970-2037) with a smaller file size.  The img API is now versioned - you
  can select the new "version 1" by compiling with -DIMG_API_VERSION=1, which
  gives the survey dates in days in days1 and days2 instead of as time_t
  values in date1 and date2.  Fixes ticket#14.

* Consistently use http://survex.com/ rather than http://www.survex.com/ - the
  former has been the canonical name for some time, with www.survex.com just
  redirecting to it.

* (Unix version): Use unlocked file I/O if available, which can be much faster
  in some cases (we don't need the locking as we don't do multithreaded file
  I/O).

* (Mac version): Fix compilation failure due to clash with Point in Mac OS X
  headers.

* (Mac version): buildmacosx.sh now works again.

* Most tests weren't actually running any testcases (looks like a sh
  portability issue).  This is now fixed, and fortunately all tests still pass.

* Include the extra .isl translation files for Innosetup in the source archive.

Changes in 1.1.14 (2010-07-26):

* Restore compatibility with wxWidgets 2.6 (1.1.13 required wxWidgets 2.8).

* aven:

  + After processing survey data, if there were warnings or errors, add a
    "Rerun" button to allow easy reprocessing after fixing problems.  If there
    were only warnings, also add an "OK" button to allow moving on to viewing
    the processed survey data (fixes ticket#13).

  + Optimise updating of the cavern log window (hopefully fixes ticket#12).

  + Fix links in cavern log window to link from exactly '<file>:<line>' (and
    not the ': ' after), and to make the title for the terminal the
    warning/error message.  Avoid false positives by checking that '<line>' is
    a number.

  + Don't double escape the contents of href and target in links in the cavern
    log window.

  + Improve handling of the splitter window, fixing behavioural glitches in
    various cases.

  + Highlight stations matching any current search when a file is loaded.
    (ticket#9)

  + (Mac version): Fix build issue due to Mac OS X polluting the global
    namespace with its own "Point" class.

  + (Unix version): The Gnome print dialog has its own preview window so
    suppress ours if using the Gnome one.

  + (Unix version): Link aven with -lGLU which SuSE Linux needs.

  + (Microsoft Windows version): Fix handling of a double-click on the survey
    tree when built with wxWidgets >= 2.8.11.

* cavern: Report relevant file and line number for three warnings which didn't
  give them before.

* (Unix and Mac versions): configure: Update the wx-config probing code -
  wxmac-config etc aren't present with newer wxWidgets versions so there's no
  point looking for them now.

* (Mac version): buildmacosx.sh: This script builds a diskimage with Survex in
  for easy installation.  Update it to work with the latest Survex versions
  (use WX_CONFIG not WXCONFIG; use a Unicode build of wxWidgets; if building a
  private wxWidgets, use 2.8.11 not 2.7.0-1).

* manual:

  + Correctly capitalise "GTK".

  + Note that on Linux we only regularly test builds with the GTK+ version
    (change taken from 1.0).

* Fixed the cad3d man page, which was an empty file in 1.1.13.

Changes in 1.1.13 (2010-06-16):

* Say "wxWidgets" instead of "wxWindows" consistently.

* img.c: Fix small memory leak (filename_opened member).

* cad3d, aven: Fix export to SVG when a label contains a '%' character.

* aven:

  + wxWidgets 2.6.0 or newer is now required.

  + A "Unicode" build of wxWidgets is now supported.  An "ANSI" build may still
    work but hasn't been tested recently (all packaged versions of wxWidgets
    seem to be Unicode now).

  + Fix potential uses of uninitialised variables which may have been causing
    occasional glitches when loading a file on start-up.

  + Improvements to the handling of the font used for plotting labels and other
    text on the survey pane:

    - Loading the font file is more efficient.

    - Character spacing is improved.

    - Default font is now anti-aliased.

  + "About" dialog:

    - Add "Copy" button to copy the system info to the clipboard for easier
      bug reporting.

    - List OpenGL extensions last, since there are usually lots of them with a
      modern gfx card.

    - Fix 100% CPU usage while the "About" dialog is open.

  + Processing .svx files:

    - Passing a .svx file on the command line now works better.

    - Put the survey data log window in a splitter in the usual frame rather
      than opening a separate frame for it.

    - Auto-scroll the log window until we've reported a warning or error.

    - Fix small memory leak.

  + The presentation filename now defaults to using the basename of the
    currently loaded dataset, but we always prompt before we first save with
    such a name.

  + Reduce memory usage when saving a screenshot.

  + Allow "Toggle Fullscreen" to work even if no survey is loaded now that we
    persist the window size (and maximised or fullscreen state) between
    invocations.

  + Fix reporting of OpenGL errors.

  + Fix glitches when tilting while looking East.

  + Added Portuguese and Slovak translations of wxWidgets messages.

* Documentation:

  + Rationalise manual formats - replace PostScript with PDF and drop RTF.

  + Drop the "alternative manual formats" self-extracting zip file - people
    will generally just want one of the formats, so downloading several
    together isn't very useful.

  + 3dformat.htm: Update for v6 format (thanks to Mike McCombe).

  + GPL.htm: Replace HTML version of licence with a link to the version on
    the FSF website.

  + ChngeLog.htm: Stop generating an HTML version of the ChangeLog - it's too
    low level to be of interest to non-developers, and developers can look at
    the source code.

* (Unix version): configure: New preferred name for specifying wx-config script
  is WX_CONFIG.  WXCONFIG still supported for compatibility.

* (Linux version): Source RPM package dropped as you can just build an RPM
  package from the source tarball.

* (Microsoft Windows version): The installer is now created with a newer
  version of InnoSetup, which gives a 10% smaller download.

Changes in 1.1.12 (2007-02-07):

* aven:

  + Remember the window size or maximised/fullscreen state between invocations.

  + Add options dialog to "Export" similar to the one for "Print".

  + The "number of pages required" in the print dialog now updates when you
    change what is to be shown (underground legs/surface legs/station
    names/crosses).

Changes in 1.1.11 (2006-11-25):

* Updated Czech, Spanish, and Slovak translations.

* (MacOS X version): Assorted OS X specific tweaks and fixes.

* aven:

  + Pick a smaller and clearer font for labels.

  + Fix character spacing.

  + Tweak display of bearing and elevation angles to look nicer with
    proportional fonts.

  + Use the title from the 3d (or plt, etc) file for the window title
    rather than the filename.

  + Show distances to 2 decimal places rather than the nearest integer.

  + Only consider underground legs when calculating the depth bands and
    depth colouring.

  + Add "Colour by Error".

  + Add entry for "white" in date and error keys.

  + When setting the view to a single point, don't change the scale.

  + If reloading the same file, don't change the view

  + Fix filetypes selector in open dialog.

  + Fix the charset we use for aven in certain cases.

  + Call msg_init before using msg_lang or it won't ever be set!

  + Pass wx the full language code to initialise the C library locale.

  + Fix bug in generating prefix tree view which could lead to a bogus
    leading dot on some survey names (bug probably introduced in 1.1.10).

  + "New Presentation" now ensures that the side panel is open

  + Fix updating of cached opengl lists when the view is reset to the
    default.

* Ignore LANG if it starts with a digit to avoid problems with bogus value for
  LANG which AutoCAD installation seems to set on MS Windows.

* (Unix version): configure: Allow SGMLTOOLS and DOCBOOK_TO_MAN to be
  specified.  Either/both can be set to ":".

* dump3d: Report unknown (to dump3d) codes returned by img.

* img library: Flag all stations as underground in the old "ASCII" .3d format.

Changes in 1.1.10 (2006-07-14):

* aven: Clicking on a survey name in the survey tree now highlights it in
  the map view.  Double-clicking zooms the view to show the clicked survey
  highlighted.  Clicking the root clears the highlighting and double-clicking
  the root restores the default view.  To expand/collapse a branch, click
  on the "[+]" or "[-]" icon to the left of the survey name.

* aven: The measuring line can now measure to anywhere in plan or elevation
  view (not just to a station!)  In plan view the horizontal distance and
  bearing are shown, while in elevation view the vertical distance is shown.

* aven: Moving the mouse over a station in the survey view now highlights
  that station in the survey tree (though it may not be visible if the
  survey(s) it is in aren't expanded).

* aven: Clicking on a station to centre the view now moves the mouse pointer
  to the new location of the station (except on Mac OS X where this isn't
  allowed).

* aven: Fix which presentation toolbar buttons are shown as depressed.

* Fix infinite loop reading 3d files with LRUD data (bug introduced in 1.1.9).

* vim files are now installed with the correct paths (bug introduced in 1.1.9).

Changes in 1.1.9 (2006-07-04):

* (Unix version): Install desktop files for aven and svxedit contributed to the
  Ubuntu package by Phil Bull, and corresponding pixmaps.

* Fix img to filter out cross-sections which don't match the subsurvey (if
  specified).  The API now returns img_XSECT_END to mark the end of a
  passage rather than setting a flag on the last img_XSECT of the passage.

* Enhance integration with the vim editor - this can now colour .err files, run
  cavern from vim and parse error output, and run aven from vim.  Tweak the
  existing vim mode for .svx files to fix a few minor bugs and add support for
  the new "*data passage" style.

* aven: fix drawing of the "blob" end of the measuring line on graphics cards
  which can't draw large enough blobs for us.

* aven: sort out confusion about what encoding everything is in which means
  that the distance measured by the measuring line actually gets displayed
  and also fixes problems with empty menu items in non-English locales in
  some cases.

* aven: redraw grey background after a menu is closed over the aven window
  with no survey loaded.

* aven: fix bug which caused printing to crash (introduced in 1.1.8).

* aven: avoid crash on some machines when opening "About" dialog before having
  loaded a survey.

* aven: Translate "Plan" and "Elevation" buttons in print view dialog.

* (Unix version): aven: Fix character set handling of cavern output.

* cavern: Report an error if a cross-section is specified for a station which
  doesn't exist.

* Updated French and Italian translations.

* (Unix version): aven: Fix "Can't open message file `en_US' using path
  `${prefix}/share/survex'" error.

* Fix bug in 3d file reading on 64 bit platforms when used in STANDALONE mode
  (doesn't affect Survex itself, but other applications which use img.c should
  update their copy).

* (Unix version): Add checks that wxWidgets is a non-unicode version (wx 2.6
  and later are caught by configure, whereas older wx versions are caught when
  trying to compile).

Changes in 1.1.8 (2006.06.30):

* Drop support for building with wxWidgets versions prior to 2.4.0
  (which was released on 2003-01-07).

* aven: Printing through aven now uses settings from the "[aven]" section
  of print.ini, and support for hierarchical sections (using "like=")
  has been disabled.

* aven: Change mouse actions to be compatible with those in Survex 1.0.
  The mousewheel now zooms in/out (it doesn't do anything in 1.0) and
  left drag is now smart about not rotating and zooming at the same
  time.

* aven: Highlighting stations now happens as you type, and pressing
  "Enter" or clicking the "Find" button now pans and zooms to show the
  highlighted stations.

* aven: Left-clicking away from a station now cancels measuring line.

* aven: Setting view to North, South, East, or West is now animated like
  the tilt from plan to elevation.

* aven: Fix presentation saving to also write "." for decimal points and
  presentation loading to accept either "." or ",".

* (Unix version): aven: Add text for all toolbar items so that aven
  will work with the Gnome desktop preference for displaying toolbars as
  icons with text or just text (wxWidgets needs fixing first though).

* (Unix version): aven: Remove the ability to detach the menu bar (yell
  if you actually used it and I'll restore it!)

* aven: Add "all survey files" option to the "open file" dialog.

* (MS Windows version): aven: Fix cursor keys to pan survey.

* (MS Windows version): Built with wxWidgets 2.6.3 instead of 2.6.2.

* (MS Windows version): Fix installer to work on Windows 2000 or XP if
  run by an unprivileged user.

* (MS Windows version): Upgrade to the latest version of InnoSetup (the
  installer builder we use) and include new installer translations for
  UK English, Spanish, Brazilian Portuguese, Italian, Romanian, and Slovak.

* (MS Windows version): aven: Include Catalan and Brazilian Portuguese
  translations of messages for wxWidgets (the GUI library we use).

* aven: Disable "Highlight exported points" if there aren't any.

* Updates to French translation from Michel Bovey.  Also updates to German,
  Italian, Catalan, Spanish, and Romanian translations.

* (Unix version): test suite: fix smoke test to pass even without X running
  (it was meant to but the code had a bug).

* aven: Check if OpenGL is available and exit cleanly with a helpful error
  if it isn't.

* (Unix version): aven: Fix --help and --version to work without a working
  X display (provided it's built with wxWidgets 2.5.1 or newer).

* aven: Automatically select the presentation tab of the notebook when the user
  selects "New Presentation" or "Open Presentation".

* aven: Fix "Delete" in the presentation list to not get passed on (and so not
  reset to default view as well).

* aven: Fix Ctrl+Insert in the presentation list not to segfault if the list is
  empty.

* aven: Fix Cursor Up and Down in the presentation list to move the highlight
  up and down instead of being passed on and moving the survey.

* aven: Improve SVG output compatibility.  Tested with Mozilla Firefox 1.5,
  Adobe's SVG browser plugin, Gimp 2.2.8, Gqview 2.0.0, Opera 8.5,
  Safari 2.0.3, and InkScape 0.42.

* aven: Put a 5mm border around exported SVG files to allow for station markers
  and non-zero width lines.

* aven: Fix crash when exporting as SVG or Sketch if labels or surface data
  was turned on.

* aven: Actually close the file we're exporting which fixes problems with it
  not always being fully written.

Changes in 1.1.7 (2005.10.18):

* cavern: Add validity checking for dates in *date commands (with feature
  test in testsuite).  A date entered as just "year" or "year.month" now
  becomes a date range for the relevant period (previously it became a single
  date near the middle of that period).

* extend: Fixed 2 uninitialised flags (should fix erratic behaviour on
  with MS Windows).

* extend: Default output name for a file called input.3d is now input_extend.3d
  rather than just extend.3d (which was annoying if you wanted to extend
  several surveys in the same directory).

* aven: OpenGL 2.0 always includes support for point sprites so rework
  our check for them to include that knowledge.

* aven: Regenerate depth bar if user switches to/from metric units.

* aven: Don't clear the "there" mark just because the mouse pointer has
  moved off a station.

* aven: When processing a .svx file, put the resultant .3d file in the
  same directory (since that's where we then try to load it from).

* aven: Fix labelling of date colouring on 32 bit platforms.

* aven: If "colour by date" is on and we load a survey with no date info
  (or all surveyed on the same date) then set "colour by none".

* aven: Make the error dialog modal and remove a signal handler once it
  has fired to prevent endless (or seemingly endless) cascades of error
  dialogs.

* aven: Enforce a minimum object volume diameter of 1m to avoid problems
  if a survey file with only one station in is loaded.

* aven: Fix problems with indicators disappearing when we're drawing
  blobs and/or crosses the slow (but always supported) way.  (Problem
  introduced in 1.1.6).

* (Unix version): aven: Really stop setting extra toolbar margin when using
  GTK2.0.  The attempt to fix this in 1.1.3 failed because __WXGTK12__ is
  set for GTK+ 1.2 or *any later release* so is true for GTK+ 2.0 too!

* (Unix version): aven: Add details of which of wxGTK, wxMotif, and wxX11
  we've been compiled with, and which GTK+/Motif version where appropriate.

* (Unix version): Fixed build on Fedora Core 3.

* documentation: Updates to 3d file format specification from Mike McCombe.

Changes in 1.1.6 (2005.10.10):

* (MS Windows version): Distribution is about a third smaller than 1.1.5
  (mostly because mingwm10.dll is no longer required).

* aven: If aven is asked to load a .svx, .dat, or .mak file, run cavern on
  it, showing cavern's output in a window (with errors and warnings clickable
  to load the offending file into an editor), and then loading the resulting
  3d file.

* aven: Added "Colour by Date" option.

* aven: Disable "Colour by Depth" option if there's no elevation variation.

* aven: Don't crash if trying to load a survey with no elevation variation.
  Instead turn off depth colouring.

* aven: Export as HPGL added.

* aven: Improved update of mouse coordinates and measuring line (thanks to
  Martin Green).

* aven: Show the coordinates of either the mouse pointer or the nearest
  survey station to it (if there is one near enough).  Showing both was
  confusing and meant the status bar overflowed on smaller displays.

* aven: When printing an extended elevation, don't show bearing and elevation.

* aven: Don't lock "flat" surveys which aren't extended elevations - a
  flat survey with LRUD data isn't flat any more!

* aven: When we have to draw blobs and crosses the slow way (because the
  graphics hardware doesn't support the fast way), draw them so that they
  should appear at the correct depth into the 3D scene instead of on top
  of everything else.

* aven: Make "play presentation backwards" icon green to match the other
  presentation icons.

* (MS Windows version): aven: Mouse clicks on the survey view now set the
  keyboard focus there.

* (MS Windows version): aven: Fix first redraw of a newly loaded survey.

* (MS Windows version): aven: Fix redrawing of measuring line.

* cavern: Store dates for img_XSECT.

* cavern: Fixed small one-off memory leak if you specify -o more than once.

* (Unix version): Check environmental variable LC_MESSAGES when deciding what
  language to use for messages.

* (MS Windows version): "Print" on a 3d file now prints through aven rather
  than the separate printer driver (Unix has done this for some time).

* Removed old printer drivers.

* img library: When creating a 3d file, ignore img_XSECT if we've been asked
  to write a file format version which doesn't support it.

Changes in 1.1.5 (2005.09.20):

* (MS Windows version): aven: Fixed crash on start-up (introduced in 1.1.4).

* aven: Make blobs round like they are in Survex 1.0.

* aven: If the graphics drivers don't support drawing blobs using OpenGL
  point markers, fall back to drawing filled circles.

* aven: If the graphics drivers support it, draw crosses as texture mapped
  OpenGL point markers which is much faster.

* aven: Cross size increased to match Survex 1.0.

* aven: We must update which blobs are displayed if display of surface or
  underground legs is toggled.

* cavern: Fix handling of a *solve followed by survey data, none of which is
  attached to the previous data.

* cavern: Fixed "No survey data" error when a *solve is followed by another
  *solve (or the implicit solve at the end of processing) with no data between
  them.

Changes in 1.1.4 (2005.09.19):

* aven: Added Aven's icon to the "About" dialog.

* aven: Use localised character for the decimal point (e.g. "," in most
  continental European countries).

* aven: Previously the survey tree would get focus and then take keypresses
  (e.g. "P", "L", "Delete").  Now we pass most keypresses across so they
  operate on the cave, and transfer the input focus across when we do.

* aven: Make pressing "Return" in the tree control expand/collapse a subtree.

* aven: Speed up intialisation by delaying creation of OpenGL lists until
  they're needed.

* aven: Added Mark Shinwell's bounding box with shadow of the survey.

* aven: Disable the "Tubes" button/menu item when there's no LRUD data.

* aven: Reworded "Restore Default Settings" as "Restore Default View".

* (Unix version): aven: Set sensible default margins for printing and preserve
  any margin values the user specifies between runs (previously margins
  defaulted to 0 each time aven was run).

* Documentation: Document *DATA PASSAGE in the manual.

Changes in 1.1.3 (2005.09.07):

* (Microsoft Windows version): Fixed build problems.

* cavern: Allow OMIT character (-) for left/right/up/down.

* aven: Remove an unnecessary menu separator.

* aven: Fix "Find" and "Hide" toolbar buttons to work with GTK2.0.

* aven: Make the tooltip for "Hide" show the number of found stations.

* aven: If * or ? is used in a glob-style pattern, force a non-substring match.

* aven: Enable "New Presentation" when there's a 3d file loaded, rather than
  when there's a presentation loaded.

* aven: Make entrances green in side panel tree list to match green blobs used
  in cave view.

* aven: Don't show surface labels if we're not showing surface data, etc.

* aven: Merge "Start Rotation" and "Stop Rotation" into "Toggle Rotation" and
  make "Space" the key for this.  Keep Return working "Stop Rotation" so
  existing users are happy, but don't advertise it.

* aven: Normalise filename by adding any extension used, and use the normalised
  filename for file history and window title.

* (Unix version): aven: Stop setting extra toolbar margin when using GTK2.0
  as the toolbar buttons already have a sensible margin - the extra margin is
  only needed with GTK1.2.

* aven: Fix handling of plumb legs in tube model.

* aven: Fixed swapped L and R in tube model.

* extend: Preserve UD cross-section information in extended elevation.

* extend: Add new messages for John Pybus' enhancements.

Changes in 1.1.2 (never formally released):

* Added support for LRUD data in .svx files, in .3d files, and aven can
  now load and display it on screen and on printouts.  The ability to "fake"
  LRUD data in aven is gone for now but will reappear in some form later.

* cavern: Removed support for writing Chasm's 3dx format.  We're going to
  fold any desirable missing chasm functionality into aven.

* aven: Rearranged mouse actions as discussed on the mailing list.  Added
  cursors for each different mouse action to help the user learn what each
  does.  Also added cursors for the "compass" and "clino" as well as the
  scalebar to suggest to the user that they can be dragged to change the view.

* (Unix version): aven: Don't segfault if LANG isn't a known language.

* tests/smoketest.tst: If X windows is running, check that we can run aven
  with --help and --version.

* tests/cavern.tst: Fixed cavern.tst to warn if it is skipping a test because
  no results are listed for it.  This revealed that there was a "newline" test
  which should have been called "badnewline", and was a broken testcase too!
  Fixed all these problems.

* cavern: Applied Simeon Warner's patch for handling backcompass, backclino,
  and omitted forward compass/clino readings in Compass DAT files.  Added
  a feature test for this to the testsuite.

* It no longer makes sense to have an option not to build aven or to build aven
  without OpenGL so remove old machinery for this from configure and the
  sources.

* (Unix version): configure: Check if "-lXxf86vm" is needed.

* configure: Better output for strcasecmp test.

* aven: Fix crosses to work much better.  Not a total fix - their position
  in the Z buffer isn't correct and they're rather slow to plot.

* aven: Don't regenerate the hittest grid every time the mouse moves while
  animating, which solves the mysterious pausing effect (thanks go to Martin
  Green for spotting this!)  Also clear all the status bar coordinates when
  animating.

* aven: Sort out clashing menu shortcuts in some languages.

* aven: Fixed compilation problem on x86_64

* SPUD: Pruned out stuff which has been done or which is not actually relevant
  to this branch.

* Merge various changes from 1.0 branch:

  + aven: Port over "printing from aven" functionality.

  + aven: Port over "export as" functionality,

  + Add David Loeffler's vim mode for .svx files.

* aven: Fix check for whether a label is behind us in perspective view.

* aven: Don't use an opengl list for drawing the indicators - we typically make
  a new list each time we plot them anyway.

* Remove lingering traces of support for RISC OS and pre-386 MSDOS

* aven: Set icon on non-Windows platforms too.  This means that with
  WindowMaker on Unix you get an icon on the AppIcon by default.

* configure: Update wxWindows checks to handle newer wx versions.

* Make all maintainer perl scripts "use bytes;" to avoid utf-8 double encoding
  problems.  They also all require Perl 5.8 now (hopefully this isn't an issue
  for anyone building from CVS).

* acinclude.m4: Quote macro name for fix autotools warning.

* Documentation: "tilt up" is "'" not ",".

* aven: Add support for mousewheels (to tilt the cave).

* aven: Fixed twisted transitions to and from pitches in certain cases.

* aven: Pick a sensible initial window size when the user's desktop is spread
  over more than one monitor (works best with wx2.5 or newer, but try to do
  better with wx2.4 or earlier as well).

* aven: Initialise GfxCore slightly later to avoid visual glitch from notebook
  contents being visible before any survey is loaded.

* aven: Allow a coloured texture to be used

* aven: Don't initialise until we have data (to the user, this means the window
  is default colour (grey for most systems) not black until a survey is
  loaded).

* aven: Fixed weird "shadowed" icons.

Changes in 1.1.1 (2004-10-06):

* (Microsoft Windows version): aven: Hopefully fix loading a survey file at
  startup.

* aven: Delay loading the bitmap for the "About" dialog until it is first
  needed.  We want start up to be as quick as possible.

Changes between 1.0.32 and 1.1.0 (never formally released):

* NOTE: Survex 1.1.X releases are development snapshots made available for
  the purposes of allowing wider testing and getting more user feedback.  Once
  the code has stabilised the version number will be raised to 1.2.0.

* aven: Now uses OpenGL for 3d rendering - you may need to install drivers if
  you're using Windows 95 - these can be obtained from:
  http://download.microsoft.com/download/win95upg/info/1/W95/EN-US/Opengl95.exe

* aven: Solid passages - passage dimensions are currently inferred from
  the leg length (pretty effective as you can measure longer legs in
  larger passages).  Use of real LRUD data coming soon...

* aven: Depth colouring is now continuously varying.

* aven: Colour by depth can now be turned off (and there's the start of a
  framework for properly implementing colour by date, error, etc).

* aven: Find stations moved onto the toolbar and now uses a simple wildcarded
  match (? matches any character, * matches any number of characters).

* aven: We now use the status bar for coordinates, distances, etc to make
  better use of screen space.

* aven: Full screen mode (F11).

* aven: Perspective view.

* aven: Context sensitive cursor shape - needs more work.

* aven: Mouse actions changed (hopefully they're now more natural, but
  you may find the change disorientating - feedback wanted on this).

* aven: Added "presentations" which allow you to set up fly-through paths
  and load/save/run them.

* aven: A presentation can be exported as a movie file.

* aven: Added Save screenshot facility.

* aven: Depth fogging option.

* aven: Added Smooth Lines option.

* aven: Added Textured Walls option.

* aven: If a survey has surface legs but no underground legs, default to
  showing the surface legs.

* cavern: Dates given to *date are now stored in the 3d file.
