Wed Jun 02 09:28:37 GMT 2010  Olly Betts <olly@survex.com>

	* ChangeLog,src/aboutdlg.cc,src/aboutdlg.h:


Index: src/aboutdlg.h
===================================================================
--- src/aboutdlg.h	(revision 3368)
+++ src/aboutdlg.h	(working copy)
@@ -27,8 +27,7 @@
 #include "wx.h"
 
 enum {
-    about_TIMER = 1000,
-    about_COPY
+    about_TIMER = 1000
 };
 
 class AboutDlg : public wxDialog {
@@ -36,6 +35,7 @@
     AboutDlg(wxWindow* parent, const wxString & icon_path);
     void OnTimer(wxTimerEvent &e);
     void OnCopy(wxCommandEvent &e);
+    void OnClose(wxCommandEvent &e);
 
 private:
     wxBitmap bitmap, bitmap_icon;
Index: src/aboutdlg.cc
===================================================================
--- src/aboutdlg.cc	(revision 3368)
+++ src/aboutdlg.cc	(working copy)
@@ -36,7 +36,8 @@
 
 BEGIN_EVENT_TABLE(AboutDlg, wxDialog)
     EVT_TIMER(about_TIMER, AboutDlg::OnTimer)
-    EVT_BUTTON(about_COPY, AboutDlg::OnCopy)
+    EVT_BUTTON(wxID_COPY, AboutDlg::OnCopy)
+    EVT_BUTTON(wxID_CLOSE, AboutDlg::OnClose)
 END_EVENT_TABLE()
 
 void
@@ -53,9 +54,17 @@
     if (wxTheClipboard->Open()) {
 	wxTheClipboard->SetData(new wxTextDataObject(info));
 	wxTheClipboard->Close();
+	// (Try to) make the selection persist after aven exits.
+	(void)wxTheClipboard->Flush();
     }
 }
 
+void
+AboutDlg::OnClose(wxCommandEvent &e)
+{
+    Destroy();
+}
+
 AboutDlg::AboutDlg(wxWindow* parent, const wxString & icon_path_) :
     wxDialog(parent, 500, wxString::Format(wmsg(/*About %s*/205), APP_NAME)),
     icon_path(icon_path_), timer(this, about_TIMER)
@@ -111,8 +120,6 @@
     } while (!l.empty());
 
     wxStaticText* licence = new wxStaticText(this, 504, licence_str);
-    wxButton* ok = new wxButton(this, wxID_OK, _("OK"));
-    ok->SetDefault();
 
     vert->Add(10, 5, 0, wxTOP, 5);
     vert->Add(title, 0, wxLEFT | wxRIGHT, 20);
@@ -168,12 +175,14 @@
 
     wxBoxSizer* bottom = new wxBoxSizer(wxHORIZONTAL);
     bottom->Add(5, 5, 1);
-    bottom->Add(new wxButton(this, about_COPY, _("Copy")), 0, wxRIGHT | wxBOTTOM, 6);
-    bottom->Add(ok, 0, wxRIGHT | wxBOTTOM, 15);
+    bottom->Add(new wxButton(this, wxID_COPY), 0, wxRIGHT | wxBOTTOM, 6);
+    wxButton* close = new wxButton(this, wxID_CLOSE);
+    bottom->Add(close, 0, wxRIGHT | wxBOTTOM, 15);
     vert->Add(bottom, 0, wxEXPAND | wxLEFT | wxRIGHT, 0);
     vert->SetMinSize(0, bitmap.GetHeight());
 
     SetSizer(horiz);
+    close->SetDefault();
 
     horiz->Fit(this);
     horiz->SetSizeHints(this);
Index: ChangeLog
===================================================================
--- ChangeLog	(revision 0)
+++ ChangeLog	(revision 0)
@@ -0,0 +1,194 @@
+Tue May 18 12:59:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* doc/HACKING.htm: Note jadetex needed.
+	  Note autoconf 2.64 works well.
+
+Tue May 18 02:06:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* src/fnt.cc: Remove now superfluous ().
+
+Mon May 17 14:33:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* debian/Makefile.am: Update EXTRA_DIST
+
+Mon May 17 05:38:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* src/cavernlog.cc: Fix small memory leak
+
+Mon May 17 05:33:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* src/img.c: Don't leak filename_opened member.
+
+Mon May 17 05:13:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* src/gfxcore.cc: Initialise all GfxCore's member variables so we
+	  don't use them uninitialised.
+
+Mon May 17 05:11:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* src/gfxcore.h: Declare constants with enum rather than #define so
+	  they automatically get allocated unique values, and so they show up
+	  in the debugger.
+
+Mon May 17 02:39:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* src/fnt.cc: Make the map array static const
+
+Mon May 17 02:30:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* src/fnt.cc: Set the font texture with GL_COLOR_INDEX so we can
+	  use a "byte format" font file without any translation, while a
+	  "bitmap format" font file needs a temporary array half the size.
+
+Mon May 17 00:56:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* src/gfxcore.cc: Initialise 3 flags when we load a survey to avoid
+	  using them potentially uninitialised.
+
+Sun May 16 14:39:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* src/mainfrm.cc: Fix cavern log window to behave if passed a .svx
+	  file on the command line.
+
+Sun May 16 14:27:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* configure.in: Update copyright years.
+
+Sun May 16 14:23:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* configure.in, src/aboutdlg.cc, src/aboutdlg.h, src/aven.cc,
+	  src/aven.h, src/avenprcore.cc, src/avenprcore.h,
+	  src/cavernlog.cc, src/cavernlog.h, src/export.cc, src/fnt.h,
+	  src/gfxcore.cc, src/gla-gl.cc, src/gla.h, src/guicontrol.cc,
+	  src/log.cc, src/mainfrm.cc, src/mainfrm.h, src/namecmp.h,
+	  src/printwx.cc, src/printwx.h:
+	  + Fix to build with a "unicode" build of wx.
+	  + Add "Copy" button to the About dialog to copy the system info
+	    to the clipboard.
+	  + List OpenGL extensions last, since there are usually lots of
+	    them with a modern gfx card.
+	  + When processing survey data, auto-scroll the log window until
+	    we've reported a warning or error.
+	  + Put the survey data log window in a splitter in the standard
+	    frame rather than having a separate frame for it.
+
+Sat Apr 17 12:13:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* src/aboutdlg.cc: Add case for "GTK+ >= 2.6".
+
+Sat Apr 17 12:12:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* src/aboutdlg.cc: Build string using preprocessor string
+	  concatenation rather than runtime appending, where possible.
+
+Sat Apr 17 12:00:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* src/aboutdlg.cc: Update (C) date.
+
+Sat Apr 17 11:59:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* src/aboutdlg.cc, src/aboutdlg.h: Use a wxTimer instead of idle
+	  events to avoid spinning on the CPU.
+
+Sat Apr 17 11:41:00 GMT 2010  Olly Betts <olly@survex.com>
+
+	* configure.in: New preferred env var for wx-config script is
+	  WX_CONFIG.  WXCONFIG still supported for compatibility.
+
+Tue Jul 28 08:16:00 GMT 2009  Olly Betts <olly@survex.com>
+
+	* src/mainfrm.cc: The presentation filename now defaults to using
+	  the basename of the currently loaded dataset, but we always prompt
+	  before we first save with such a name.
+
+Tue Jul 28 04:37:00 GMT 2009  Olly Betts <olly@survex.com>
+
+	* configure.in: Add comment to explain why we call wx-config twice.
+
+Tue Jul 28 04:36:00 GMT 2009  Olly Betts <olly@survex.com>
+
+	* src/datain.c: Use fputs(m, f) instead of fprintf(f, m) in case m
+	  contains '%' (m comes from the messages file, so this isn't
+	  exploitable by sending someone a "bad" .svx or .3d file).
+
+Mon Jul 27 03:29:00 GMT 2009  Olly Betts <olly@survex.com>
+
+	* src/mainfrm.cc: Fix to open rather than save when doing "open
+	  presentation" with wxmotif.
+
+Thu Mar 05 01:45:00 GMT 2009  Olly Betts <olly@survex.com>
+
+	* doc/3dformat.htm: Document that this is version 6 and when we
+	  started to use it.
+
+Mon Dec 15 10:34:00 GMT 2008  Olly Betts <olly@survex.com>
+
+	* src/gla-gl.cc: When saving a screenshot, perform the vertical
+	  flip of the image data in-place rather than using wxImage::Mirror()
+	  which creates a whole new wxImage object.
+
+Fri Dec 12 11:12:00 GMT 2008  Olly Betts <olly@survex.com>
+
+	* src/cad3d.c, src/export.cc: Fix export to SVG when a label
+	  contains a '%' character.
+
+Fri Dec 12 06:30:00 GMT 2008  Olly Betts <olly@survex.com>
+
+	* configure.in: Add AM_PROG_CC_C_O which newer autoreconf warns is
+	  needed.
+
+Fri Dec 12 06:28:00 GMT 2008  Olly Betts <olly@survex.com>
+
+	* configure.in: Remove AC_SUBST of CRLIB and CROBJX which are no
+	  longer set or used.
+
+Fri Dec 12 06:03:00 GMT 2008  Olly Betts <olly@survex.com>
+
+	* NEWS, buildmacosx.sh, configure.in, desc-aven.txt, doc/TODO.htm,
+	  doc/manual.sgml, doc/survex.ent, lib/messages.txt,
+	  src/aboutdlg.cc, src/aven.cc, src/aven.h, src/gfxcore.cc,
+	  src/mainfrm.cc, src/printwx.cc, src/printwx.h, src/wx.h: Say
+	  "wxWidgets" instead of "wxWindows" consistently.
+	  Require wxWidgets 2.6.0 or newer - 2.4 is really old now.
+
+Mon Mar 31 01:53:00 GMT 2008  Olly Betts <olly@survex.com>
+
+	* doc/3dformat.htm: Update for v6 format from Mike McCombe
+
+Fri Sep 07 18:29:00 GMT 2007  Olly Betts <olly@survex.com>
+
+	* src/gla-gl.cc: Calling glGetError() resets the error state, so we
+	  need to store the value in a variable rather than calling it twice!
+
+Fri Sep 07 13:54:00 GMT 2007  Olly Betts <olly@survex.com>
+
+	* src/gla-gl.cc: Add missing CHECK_GL_ERROR() calls and correct
+	  some which had the wrong descriptions.
+	  Use GL_POINT_SPRITE and GL_COORD_REPLACE instead of
+	  GL_POINT_SPRITE_ARB and GL_COORD_REPLACE_ARB.  They have the same
+	  numeric values, so the shorter (now official) names are better.
+
+Fri Sep 07 13:31:00 GMT 2007  Olly Betts <olly@survex.com>
+
+	* src/Makefile.am, src/gfxcore.cc, src/gfxcore.h, src/gla-gl.cc,
+	  src/gla.h, src/matrix4.cc, src/matrix4.h, src/quaternion.cc,
+	  src/quaternion.h: Just set the pan and tilt directly as OpenGL
+	  rotations rather than messing around setting up and then decoding a
+	  quaternion.  This fixes some glitches when tilting while looking
+	  east, and eliminates 2 source files and 2 headers!
+
+Sat Feb 10 13:56:00 GMT 2007  Olly Betts <olly@survex.com>
+
+	* NEWS, configure.in, src/aven.cc, src/wx.h:
+	  (Unix version): aven: Fix display of degree symbol in status bar and
+	  messages with accented characters in.
+	  (Mac OS X version): Require at least wxWidgets 2.5.1.
+
+Sat Feb 10 13:46:00 GMT 2007  Olly Betts <olly@survex.com>
+
+	* src/message.c: Test S_ISREG since that's what we use here
+
+Sat Feb 10 13:37:00 GMT 2007  Olly Betts <olly@survex.com>
+
+	* src/message.c: Always use utf-8 for aven on unix
+

Tue May 18 12:59:00 GMT 2010  Olly Betts <olly@survex.com>

	* doc/HACKING.htm: Note jadetex needed.
	  Note autoconf 2.64 works well.

Tue May 18 02:06:00 GMT 2010  Olly Betts <olly@survex.com>

	* src/fnt.cc: Remove now superfluous ().

Mon May 17 14:33:00 GMT 2010  Olly Betts <olly@survex.com>

	* debian/Makefile.am: Update EXTRA_DIST

Mon May 17 05:38:00 GMT 2010  Olly Betts <olly@survex.com>

	* src/cavernlog.cc: Fix small memory leak

Mon May 17 05:33:00 GMT 2010  Olly Betts <olly@survex.com>

	* src/img.c: Don't leak filename_opened member.

Mon May 17 05:13:00 GMT 2010  Olly Betts <olly@survex.com>

	* src/gfxcore.cc: Initialise all GfxCore's member variables so we
	  don't use them uninitialised.

Mon May 17 05:11:00 GMT 2010  Olly Betts <olly@survex.com>

	* src/gfxcore.h: Declare constants with enum rather than #define so
	  they automatically get allocated unique values, and so they show up
	  in the debugger.

Mon May 17 02:39:00 GMT 2010  Olly Betts <olly@survex.com>

	* src/fnt.cc: Make the map array static const

Mon May 17 02:30:00 GMT 2010  Olly Betts <olly@survex.com>

	* src/fnt.cc: Set the font texture with GL_COLOR_INDEX so we can
	  use a "byte format" font file without any translation, while a
	  "bitmap format" font file needs a temporary array half the size.

Mon May 17 00:56:00 GMT 2010  Olly Betts <olly@survex.com>

	* src/gfxcore.cc: Initialise 3 flags when we load a survey to avoid
	  using them potentially uninitialised.

Sun May 16 14:39:00 GMT 2010  Olly Betts <olly@survex.com>

	* src/mainfrm.cc: Fix cavern log window to behave if passed a .svx
	  file on the command line.

Sun May 16 14:27:00 GMT 2010  Olly Betts <olly@survex.com>

	* configure.in: Update copyright years.

Sun May 16 14:23:00 GMT 2010  Olly Betts <olly@survex.com>

	* configure.in, src/aboutdlg.cc, src/aboutdlg.h, src/aven.cc,
	  src/aven.h, src/avenprcore.cc, src/avenprcore.h,
	  src/cavernlog.cc, src/cavernlog.h, src/export.cc, src/fnt.h,
	  src/gfxcore.cc, src/gla-gl.cc, src/gla.h, src/guicontrol.cc,
	  src/log.cc, src/mainfrm.cc, src/mainfrm.h, src/namecmp.h,
	  src/printwx.cc, src/printwx.h:
	  + Fix to build with a "unicode" build of wx.
	  + Add "Copy" button to the About dialog to copy the system info
	    to the clipboard.
	  + List OpenGL extensions last, since there are usually lots of
	    them with a modern gfx card.
	  + When processing survey data, auto-scroll the log window until
	    we've reported a warning or error.
	  + Put the survey data log window in a splitter in the standard
	    frame rather than having a separate frame for it.

Sat Apr 17 12:13:00 GMT 2010  Olly Betts <olly@survex.com>

	* src/aboutdlg.cc: Add case for "GTK+ >= 2.6".

Sat Apr 17 12:12:00 GMT 2010  Olly Betts <olly@survex.com>

	* src/aboutdlg.cc: Build string using preprocessor string
	  concatenation rather than runtime appending, where possible.

Sat Apr 17 12:00:00 GMT 2010  Olly Betts <olly@survex.com>

	* src/aboutdlg.cc: Update (C) date.

Sat Apr 17 11:59:00 GMT 2010  Olly Betts <olly@survex.com>

	* src/aboutdlg.cc, src/aboutdlg.h: Use a wxTimer instead of idle
	  events to avoid spinning on the CPU.

Sat Apr 17 11:41:00 GMT 2010  Olly Betts <olly@survex.com>

	* configure.in: New preferred env var for wx-config script is
	  WX_CONFIG.  WXCONFIG still supported for compatibility.

Tue Jul 28 08:16:00 GMT 2009  Olly Betts <olly@survex.com>

	* src/mainfrm.cc: The presentation filename now defaults to using
	  the basename of the currently loaded dataset, but we always prompt
	  before we first save with such a name.

Tue Jul 28 04:37:00 GMT 2009  Olly Betts <olly@survex.com>

	* configure.in: Add comment to explain why we call wx-config twice.

Tue Jul 28 04:36:00 GMT 2009  Olly Betts <olly@survex.com>

	* src/datain.c: Use fputs(m, f) instead of fprintf(f, m) in case m
	  contains '%' (m comes from the messages file, so this isn't
	  exploitable by sending someone a "bad" .svx or .3d file).

Mon Jul 27 03:29:00 GMT 2009  Olly Betts <olly@survex.com>

	* src/mainfrm.cc: Fix to open rather than save when doing "open
	  presentation" with wxmotif.

Thu Mar 05 01:45:00 GMT 2009  Olly Betts <olly@survex.com>

	* doc/3dformat.htm: Document that this is version 6 and when we
	  started to use it.

Mon Dec 15 10:34:00 GMT 2008  Olly Betts <olly@survex.com>

	* src/gla-gl.cc: When saving a screenshot, perform the vertical
	  flip of the image data in-place rather than using wxImage::Mirror()
	  which creates a whole new wxImage object.

Fri Dec 12 11:12:00 GMT 2008  Olly Betts <olly@survex.com>

	* src/cad3d.c, src/export.cc: Fix export to SVG when a label
	  contains a '%' character.

Fri Dec 12 06:30:00 GMT 2008  Olly Betts <olly@survex.com>

	* configure.in: Add AM_PROG_CC_C_O which newer autoreconf warns is
	  needed.

Fri Dec 12 06:28:00 GMT 2008  Olly Betts <olly@survex.com>

	* configure.in: Remove AC_SUBST of CRLIB and CROBJX which are no
	  longer set or used.

Fri Dec 12 06:03:00 GMT 2008  Olly Betts <olly@survex.com>

	* NEWS, buildmacosx.sh, configure.in, desc-aven.txt, doc/TODO.htm,
	  doc/manual.sgml, doc/survex.ent, lib/messages.txt,
	  src/aboutdlg.cc, src/aven.cc, src/aven.h, src/gfxcore.cc,
	  src/mainfrm.cc, src/printwx.cc, src/printwx.h, src/wx.h: Say
	  "wxWidgets" instead of "wxWindows" consistently.
	  Require wxWidgets 2.6.0 or newer - 2.4 is really old now.

Mon Mar 31 01:53:00 GMT 2008  Olly Betts <olly@survex.com>

	* doc/3dformat.htm: Update for v6 format from Mike McCombe

Fri Sep 07 18:29:00 GMT 2007  Olly Betts <olly@survex.com>

	* src/gla-gl.cc: Calling glGetError() resets the error state, so we
	  need to store the value in a variable rather than calling it twice!

Fri Sep 07 13:54:00 GMT 2007  Olly Betts <olly@survex.com>

	* src/gla-gl.cc: Add missing CHECK_GL_ERROR() calls and correct
	  some which had the wrong descriptions.
	  Use GL_POINT_SPRITE and GL_COORD_REPLACE instead of
	  GL_POINT_SPRITE_ARB and GL_COORD_REPLACE_ARB.  They have the same
	  numeric values, so the shorter (now official) names are better.

Fri Sep 07 13:31:00 GMT 2007  Olly Betts <olly@survex.com>

	* src/Makefile.am, src/gfxcore.cc, src/gfxcore.h, src/gla-gl.cc,
	  src/gla.h, src/matrix4.cc, src/matrix4.h, src/quaternion.cc,
	  src/quaternion.h: Just set the pan and tilt directly as OpenGL
	  rotations rather than messing around setting up and then decoding a
	  quaternion.  This fixes some glitches when tilting while looking
	  east, and eliminates 2 source files and 2 headers!

Sat Feb 10 13:56:00 GMT 2007  Olly Betts <olly@survex.com>

	* NEWS, configure.in, src/aven.cc, src/wx.h:
	  (Unix version): aven: Fix display of degree symbol in status bar and
	  messages with accented characters in.
	  (Mac OS X version): Require at least wxWidgets 2.5.1.

Sat Feb 10 13:46:00 GMT 2007  Olly Betts <olly@survex.com>

	* src/message.c: Test S_ISREG since that's what we use here

Sat Feb 10 13:37:00 GMT 2007  Olly Betts <olly@survex.com>

	* src/message.c: Always use utf-8 for aven on unix

